var sr=Object.defineProperty;var xt=(e,r,t)=>r in e?sr(e,r,{enumerable:!0,configurable:!0,writable:!0,value:t}):e[r]=t;var Tt=(e,r)=>{for(var t in r)sr(e,t,{get:r[t],enumerable:!0})};var c=(e,r,t)=>xt(e,typeof r!="symbol"?r+"":r,t);function q(e,r){if(!e)throw new Error(r||"loader assertion failed.")}var x={self:typeof self<"u"&&self,window:typeof window<"u"&&window,global:typeof globalThis<"u"&&globalThis,document:typeof document<"u"&&document},ar=x.self||x.window||x.global||{},cr=x.window||x.self||x.global||{},fr=x.global||x.self||x.window||{},ur=x.document||{};var p=!!(typeof process!="object"||String(process)!=="[object process]"||process.browser),lr=typeof importScripts=="function",ir=typeof process<"u"&&process.version&&/v([0-9]*)/.exec(process.version),At=ir&&parseFloat(ir[1])||0;var pe=globalThis,St=globalThis.document||{},he=globalThis.process||{},kt=globalThis.console,an=globalThis.navigator||{};function mr(e){if(typeof window<"u"&&window.process?.type==="renderer"||typeof process<"u"&&process.versions?.electron)return!0;let r=typeof navigator<"u"&&navigator.userAgent,t=e||r;return!!(t&&t.indexOf("Electron")>=0)}function I(){return!(typeof process=="object"&&String(process)==="[object process]"&&!process?.browser)||mr()}var Ee="4.1.0";function Et(e){try{let r=window[e],t="__storage_test__";return r.setItem(t,t),r.removeItem(t),r}catch{return null}}var de=class{constructor(r,t,o="sessionStorage"){this.storage=Et(o),this.id=r,this.config=t,this._loadConfiguration()}getConfiguration(){return this.config}setConfiguration(r){if(Object.assign(this.config,r),this.storage){let t=JSON.stringify(this.config);this.storage.setItem(this.id,t)}}_loadConfiguration(){let r={};if(this.storage){let t=this.storage.getItem(this.id);r=t?JSON.parse(t):{}}return Object.assign(this.config,r),this}};function pr(e){let r;return e<10?r=`${e.toFixed(2)}ms`:e<100?r=`${e.toFixed(1)}ms`:e<1e3?r=`${e.toFixed(0)}ms`:r=`${(e/1e3).toFixed(2)}s`,r}function hr(e,r=8){let t=Math.max(r-e.length,0);return`${" ".repeat(t)}${e}`}var ge;(function(e){e[e.BLACK=30]="BLACK",e[e.RED=31]="RED",e[e.GREEN=32]="GREEN",e[e.YELLOW=33]="YELLOW",e[e.BLUE=34]="BLUE",e[e.MAGENTA=35]="MAGENTA",e[e.CYAN=36]="CYAN",e[e.WHITE=37]="WHITE",e[e.BRIGHT_BLACK=90]="BRIGHT_BLACK",e[e.BRIGHT_RED=91]="BRIGHT_RED",e[e.BRIGHT_GREEN=92]="BRIGHT_GREEN",e[e.BRIGHT_YELLOW=93]="BRIGHT_YELLOW",e[e.BRIGHT_BLUE=94]="BRIGHT_BLUE",e[e.BRIGHT_MAGENTA=95]="BRIGHT_MAGENTA",e[e.BRIGHT_CYAN=96]="BRIGHT_CYAN",e[e.BRIGHT_WHITE=97]="BRIGHT_WHITE"})(ge||(ge={}));var Bt=10;function dr(e){return typeof e!="string"?e:(e=e.toUpperCase(),ge[e]||ge.WHITE)}function gr(e,r,t){return!I&&typeof e=="string"&&(r&&(e=`\x1B[${dr(r)}m${e}\x1B[39m`),t&&(e=`\x1B[${dr(t)+Bt}m${e}\x1B[49m`)),e}function yr(e,r=["constructor"]){let t=Object.getPrototypeOf(e),o=Object.getOwnPropertyNames(t),n=e;for(let s of o){let i=n[s];typeof i=="function"&&(r.find(a=>s===a)||(n[s]=i.bind(e)))}}function Q(e,r){if(!e)throw new Error(r||"Assertion failed")}function F(){let e;if(I()&&pe.performance)e=pe?.performance?.now?.();else if("hrtime"in he){let r=he?.hrtime?.();e=r[0]*1e3+r[1]/1e6}else e=Date.now();return e}var O={debug:I()&&console.debug||console.log,log:console.log,info:console.info,warn:console.warn,error:console.error},Lt={enabled:!0,level:0};function P(){}var wr={},br={once:!0},T=class{constructor({id:r}={id:""}){this.VERSION=Ee,this._startTs=F(),this._deltaTs=F(),this.userData={},this.LOG_THROTTLE_TIMEOUT=0,this.id=r,this.userData={},this._storage=new de(`__probe-${this.id}__`,Lt),this.timeStamp(`${this.id} started`),yr(this),Object.seal(this)}set level(r){this.setLevel(r)}get level(){return this.getLevel()}isEnabled(){return this._storage.config.enabled}getLevel(){return this._storage.config.level}getTotal(){return Number((F()-this._startTs).toPrecision(10))}getDelta(){return Number((F()-this._deltaTs).toPrecision(10))}set priority(r){this.level=r}get priority(){return this.level}getPriority(){return this.level}enable(r=!0){return this._storage.setConfiguration({enabled:r}),this}setLevel(r){return this._storage.setConfiguration({level:r}),this}get(r){return this._storage.config[r]}set(r,t){this._storage.setConfiguration({[r]:t})}settings(){console.table?console.table(this._storage.config):console.log(this._storage.config)}assert(r,t){if(!r)throw new Error(t||"Assertion failed")}warn(r){return this._getLogFunction(0,r,O.warn,arguments,br)}error(r){return this._getLogFunction(0,r,O.error,arguments)}deprecated(r,t){return this.warn(`\`${r}\` is deprecated and will be removed in a later version. Use \`${t}\` instead`)}removed(r,t){return this.error(`\`${r}\` has been removed. Use \`${t}\` instead`)}probe(r,t){return this._getLogFunction(r,t,O.log,arguments,{time:!0,once:!0})}log(r,t){return this._getLogFunction(r,t,O.debug,arguments)}info(r,t){return this._getLogFunction(r,t,console.info,arguments)}once(r,t){return this._getLogFunction(r,t,O.debug||O.info,arguments,br)}table(r,t,o){return t?this._getLogFunction(r,t,console.table||P,o&&[o],{tag:It(t)}):P}time(r,t){return this._getLogFunction(r,t,console.time?console.time:console.info)}timeEnd(r,t){return this._getLogFunction(r,t,console.timeEnd?console.timeEnd:console.info)}timeStamp(r,t){return this._getLogFunction(r,t,console.timeStamp||P)}group(r,t,o={collapsed:!1}){let n=xr({logLevel:r,message:t,opts:o}),{collapsed:s}=o;return n.method=(s?console.groupCollapsed:console.group)||console.info,this._getLogFunction(n)}groupCollapsed(r,t,o={}){return this.group(r,t,Object.assign({},o,{collapsed:!0}))}groupEnd(r){return this._getLogFunction(r,"",console.groupEnd||P)}withGroup(r,t,o){this.group(r,t)();try{o()}finally{this.groupEnd(r)()}}trace(){console.trace&&console.trace()}_shouldLog(r){return this.isEnabled()&&this.getLevel()>=Tr(r)}_getLogFunction(r,t,o,n,s){if(this._shouldLog(r)){s=xr({logLevel:r,message:t,args:n,opts:s}),o=o||s.method,Q(o),s.total=this.getTotal(),s.delta=this.getDelta(),this._deltaTs=F();let i=s.tag||s.message;if(s.once&&i)if(!wr[i])wr[i]=F();else return P;return t=Rt(this.id,s.message,s),o.bind(console,t,...s.args)}return P}};T.VERSION=Ee;function Tr(e){if(!e)return 0;let r;switch(typeof e){case"number":r=e;break;case"object":r=e.logLevel||e.priority||0;break;default:return 0}return Q(Number.isFinite(r)&&r>=0),r}function xr(e){let{logLevel:r,message:t}=e;e.logLevel=Tr(r);let o=e.args?Array.from(e.args):[];for(;o.length&&o.shift()!==t;);switch(typeof r){case"string":case"function":t!==void 0&&o.unshift(t),e.message=r;break;case"object":Object.assign(e,r);break;default:}typeof e.message=="function"&&(e.message=e.message());let n=typeof e.message;return Q(n==="string"||n==="object"),Object.assign(e,{args:o},e.opts)}function Rt(e,r,t){if(typeof r=="string"){let o=t.time?hr(pr(t.total)):"";r=t.time?`${e}: ${o}  ${r}`:`${e}: ${r}`,r=gr(r,t.color,t.background)}return r}function It(e){for(let r in e)for(let t in e[r])return t||"untitled";return"empty"}globalThis.probe={};var Nn=new T({id:"@probe.gl/log"});var Be="4.3.0-beta.3",Ft=Be[0]>="0"&&Be[0]<="9"?`v${Be}`:"";function Nt(){let e=new T({id:"loaders.gl"});return globalThis.loaders=globalThis.loaders||{},globalThis.loaders.log=e,globalThis.loaders.version=Ft,globalThis.probe=globalThis.probe||{},globalThis.probe.loaders=e,e}var Le=Nt();function Re(e,r){return Ar(e||{},r)}function Ar(e,r,t=0){if(t>3)return r;let o={...e};for(let[n,s]of Object.entries(r))s&&typeof s=="object"&&!Array.isArray(s)?o[n]=Ar(o[n]||{},r[n],t+1):o[n]=r[n];return o}function Ie(e){var r;globalThis.loaders||(globalThis.loaders={}),(r=globalThis.loaders).modules||(r.modules={}),Object.assign(globalThis.loaders.modules,e)}var Sr="latest";function Mt(){return globalThis._loadersgl_?.version||(globalThis._loadersgl_=globalThis._loadersgl_||{},globalThis._loadersgl_.version="4.3.0-beta.3"),globalThis._loadersgl_.version}var J=Mt();function l(e,r){if(!e)throw new Error(r||"loaders.gl assertion failed.")}var A={self:typeof self<"u"&&self,window:typeof window<"u"&&window,global:typeof globalThis<"u"&&globalThis,document:typeof document<"u"&&document},jn=A.self||A.window||A.global||{},zn=A.window||A.self||A.global||{},Vn=A.global||A.self||A.window||{},Hn=A.document||{};var d=typeof process!="object"||String(process)!=="[object process]"||process.browser;var _r=typeof window<"u"&&typeof window.orientation<"u",kr=typeof process<"u"&&process.version&&/v([0-9]*)/.exec(process.version),Gn=kr&&parseFloat(kr[1])||0;var K=class{constructor(r,t){c(this,"name");c(this,"workerThread");c(this,"isRunning",!0);c(this,"result");c(this,"_resolve",()=>{});c(this,"_reject",()=>{});this.name=r,this.workerThread=t,this.result=new Promise((o,n)=>{this._resolve=o,this._reject=n})}postMessage(r,t){this.workerThread.postMessage({source:"loaders.gl",type:r,payload:t})}done(r){l(this.isRunning),this.isRunning=!1,this._resolve(r)}error(r){l(this.isRunning),this.isRunning=!1,this._reject(r)}};var v=class{terminate(){}};var Fe=new Map;function Er(e){l(e.source&&!e.url||!e.source&&e.url);let r=Fe.get(e.source||e.url);return r||(e.url&&(r=Wt(e.url),Fe.set(e.url,r)),e.source&&(r=Br(e.source),Fe.set(e.source,r))),l(r),r}function Wt(e){if(!e.startsWith("http"))return e;let r=Ct(e);return Br(r)}function Br(e){let r=new Blob([e],{type:"application/javascript"});return URL.createObjectURL(r)}function Ct(e){return`try {
  importScripts('${e}');
} catch (error) {
  console.error(error);
  throw error;
}`}function Ne(e,r=!0,t){let o=t||new Set;if(e){if(Lr(e))o.add(e);else if(Lr(e.buffer))o.add(e.buffer);else if(!ArrayBuffer.isView(e)){if(r&&typeof e=="object")for(let n in e)Ne(e[n],r,o)}}return t===void 0?Array.from(o):[]}function Lr(e){return e?e instanceof ArrayBuffer||typeof MessagePort<"u"&&e instanceof MessagePort||typeof ImageBitmap<"u"&&e instanceof ImageBitmap||typeof OffscreenCanvas<"u"&&e instanceof OffscreenCanvas:!1}function Me(e){if(e===null)return{};let r=Object.assign({},e);return Object.keys(r).forEach(t=>{typeof e[t]=="object"&&!ArrayBuffer.isView(e[t])&&!(e[t]instanceof Array)?r[t]=Me(e[t]):typeof r[t]=="function"||r[t]instanceof RegExp?r[t]={}:r[t]=e[t]}),r}var We=()=>{},B=class{constructor(r){c(this,"name");c(this,"source");c(this,"url");c(this,"terminated",!1);c(this,"worker");c(this,"onMessage");c(this,"onError");c(this,"_loadableURL","");let{name:t,source:o,url:n}=r;l(o||n),this.name=t,this.source=o,this.url=n,this.onMessage=We,this.onError=s=>console.log(s),this.worker=d?this._createBrowserWorker():this._createNodeWorker()}static isSupported(){return typeof Worker<"u"&&d||typeof v<"u"&&!d}destroy(){this.onMessage=We,this.onError=We,this.worker.terminate(),this.terminated=!0}get isRunning(){return!!this.onMessage}postMessage(r,t){t=t||Ne(r),this.worker.postMessage(r,t)}_getErrorFromErrorEvent(r){let t="Failed to load ";return t+=`worker ${this.name} from ${this.url}. `,r.message&&(t+=`${r.message} in `),r.lineno&&(t+=`:${r.lineno}:${r.colno}`),new Error(t)}_createBrowserWorker(){this._loadableURL=Er({source:this.source,url:this.url});let r=new Worker(this._loadableURL,{name:this.name});return r.onmessage=t=>{t.data?this.onMessage(t.data):this.onError(new Error("No data received"))},r.onerror=t=>{this.onError(this._getErrorFromErrorEvent(t)),this.terminated=!0},r.onmessageerror=t=>console.error(t),r}_createNodeWorker(){let r;if(this.url){let o=this.url.includes(":/")||this.url.startsWith("/")?this.url:`./${this.url}`;r=new v(o,{eval:!1})}else if(this.source)r=new v(this.source,{eval:!0});else throw new Error("no worker");return r.on("message",t=>{this.onMessage(t)}),r.on("error",t=>{this.onError(t)}),r.on("exit",t=>{}),r}};var Y=class{constructor(r){c(this,"name","unnamed");c(this,"source");c(this,"url");c(this,"maxConcurrency",1);c(this,"maxMobileConcurrency",1);c(this,"onDebug",()=>{});c(this,"reuseWorkers",!0);c(this,"props",{});c(this,"jobQueue",[]);c(this,"idleQueue",[]);c(this,"count",0);c(this,"isDestroyed",!1);this.source=r.source,this.url=r.url,this.setProps(r)}static isSupported(){return B.isSupported()}destroy(){this.idleQueue.forEach(r=>r.destroy()),this.isDestroyed=!0}setProps(r){this.props={...this.props,...r},r.name!==void 0&&(this.name=r.name),r.maxConcurrency!==void 0&&(this.maxConcurrency=r.maxConcurrency),r.maxMobileConcurrency!==void 0&&(this.maxMobileConcurrency=r.maxMobileConcurrency),r.reuseWorkers!==void 0&&(this.reuseWorkers=r.reuseWorkers),r.onDebug!==void 0&&(this.onDebug=r.onDebug)}async startJob(r,t=(n,s,i)=>n.done(i),o=(n,s)=>n.error(s)){let n=new Promise(s=>(this.jobQueue.push({name:r,onMessage:t,onError:o,onStart:s}),this));return this._startQueuedJob(),await n}async _startQueuedJob(){if(!this.jobQueue.length)return;let r=this._getAvailableWorker();if(!r)return;let t=this.jobQueue.shift();if(t){this.onDebug({message:"Starting job",name:t.name,workerThread:r,backlog:this.jobQueue.length});let o=new K(t.name,r);r.onMessage=n=>t.onMessage(o,n.type,n.payload),r.onError=n=>t.onError(o,n),t.onStart(o);try{await o.result}catch(n){console.error(`Worker exception: ${n}`)}finally{this.returnWorkerToQueue(r)}}}returnWorkerToQueue(r){!d||this.isDestroyed||!this.reuseWorkers||this.count>this._getMaxConcurrency()?(r.destroy(),this.count--):this.idleQueue.push(r),this.isDestroyed||this._startQueuedJob()}_getAvailableWorker(){if(this.idleQueue.length>0)return this.idleQueue.shift()||null;if(this.count<this._getMaxConcurrency()){this.count++;let r=`${this.name.toLowerCase()} (#${this.count} of ${this.maxConcurrency})`;return new B({name:r,source:this.source,url:this.url})}return null}_getMaxConcurrency(){return _r?this.maxMobileConcurrency:this.maxConcurrency}};var Ot={maxConcurrency:3,maxMobileConcurrency:1,reuseWorkers:!0,onDebug:()=>{}},L=class L{constructor(r){c(this,"props");c(this,"workerPools",new Map);this.props={...Ot},this.setProps(r),this.workerPools=new Map}static isSupported(){return B.isSupported()}static getWorkerFarm(r={}){return L._workerFarm=L._workerFarm||new L({}),L._workerFarm.setProps(r),L._workerFarm}destroy(){for(let r of this.workerPools.values())r.destroy();this.workerPools=new Map}setProps(r){this.props={...this.props,...r};for(let t of this.workerPools.values())t.setProps(this._getWorkerPoolProps())}getWorkerPool(r){let{name:t,source:o,url:n}=r,s=this.workerPools.get(t);return s||(s=new Y({name:t,source:o,url:n}),s.setProps(this._getWorkerPoolProps()),this.workerPools.set(t,s)),s}_getWorkerPoolProps(){return{maxConcurrency:this.props.maxConcurrency,maxMobileConcurrency:this.props.maxMobileConcurrency,reuseWorkers:this.props.reuseWorkers,onDebug:this.props.onDebug}}};c(L,"_workerFarm");var g=L;function Rr(e){let r=e.version!==J?` (worker-utils@${J})`:"";return`${e.name}@${e.version}${r}`}function Z(e,r={}){let t=r[e.id]||{},o=d?`${e.id}-worker.js`:`${e.id}-worker-node.js`,n=t.workerUrl;if(!n&&e.id==="compression"&&(n=r.workerUrl),r._workerType==="test"&&(d?n=`modules/${e.module}/dist/${o}`:n=`modules/${e.module}/src/workers/${e.id}-worker-node.ts`),!n){let s=e.version;s==="latest"&&(s=Sr);let i=s?`@${s}`:"";n=`https://unpkg.com/@loaders.gl/${e.module}${i}/dist/${o}`}return l(n),n}async function Ce(e,r,t={},o={}){let n=Rr(e),s=g.getWorkerFarm(t),{source:i}=t,a={name:n,source:i};i||(a.url=Z(e,t));let f=s.getWorkerPool(a),u=t.jobName||e.name,k=await f.startJob(u,Pt.bind(null,o)),E=Me(t);return k.postMessage("process",{input:r,options:E}),(await k.result).result}async function Pt(e,r,t,o){switch(t){case"done":r.done(o);break;case"error":r.error(new Error(o.error));break;case"process":let{id:n,input:s,options:i}=o;try{if(!e.process){r.postMessage("error",{id:n,error:"Worker not set up to process on main thread"});return}let a=await e.process(s,i);r.postMessage("done",{id:n,result:a})}catch(a){let f=a instanceof Error?a.message:"unknown error";r.postMessage("error",{id:n,error:f})}break;default:console.warn(`process-on-worker: unknown message ${t}`)}}function Oe(e,r=J){l(e,"no worker provided");let t=e.version;return!(!r||!t)}function Pe(e,r){return!g.isSupported()||!d&&!r?._nodeWorkers?!1:e.worker&&r?.worker}async function ve(e,r,t,o,n){let s=e.id,i=Z(e,t),f=g.getWorkerFarm(t).getWorkerPool({name:s,url:i});t=JSON.parse(JSON.stringify(t)),o=JSON.parse(JSON.stringify(o||{}));let u=await f.startJob("process-on-worker",vt.bind(null,n));return u.postMessage("process",{input:r,options:t,context:o}),await(await u.result).result}async function vt(e,r,t,o){switch(t){case"done":r.done(o);break;case"error":r.error(new Error(o.error));break;case"process":let{id:n,input:s,options:i}=o;try{let a=await e(s,i);r.postMessage("done",{id:n,result:a})}catch(a){let f=a instanceof Error?a.message:"unknown error";r.postMessage("error",{id:n,error:f})}break;default:console.warn(`parse-with-worker unknown message ${t}`)}}function Ue(e,r){return!g.isSupported()||!p&&!r?._nodeWorkers?!1:e.worker&&r?.worker}function $e(e,r,t){if(t=t||e.byteLength,e.byteLength<t||r.byteLength<t)return!1;let o=new Uint8Array(e),n=new Uint8Array(r);for(let s=0;s<o.length;++s)if(o[s]!==n[s])return!1;return!0}function X(...e){return Ir(e)}function Ir(e){let r=e.map(s=>s instanceof ArrayBuffer?new Uint8Array(s):s),t=r.reduce((s,i)=>s+i.byteLength,0),o=new Uint8Array(t),n=0;for(let s of r)o.set(s,n),n+=s.byteLength;return o.buffer}async function*Fr(e,r={}){let t=new TextDecoder(void 0,r);for await(let o of e)yield typeof o=="string"?o:t.decode(o,{stream:!0})}async function*Nr(e){let r=new TextEncoder;for await(let t of e)yield typeof t=="string"?r.encode(t):t}async function*Mr(e){let r="";for await(let t of e){r+=t;let o;for(;(o=r.indexOf(`
`))>=0;){let n=r.slice(0,o+1);r=r.slice(o+1),yield n}}r.length>0&&(yield r)}async function*Wr(e){let r=1;for await(let t of e)yield{counter:r,line:t},r++}async function Cr(e,r){for(;;){let{done:t,value:o}=await e.next();if(t){e.return();return}if(r(o))return}}async function U(e){let r=[];for await(let t of e)r.push(t);return X(...r)}function ee(){let e;if(typeof window<"u"&&window.performance)e=window.performance.now();else if(typeof process<"u"&&process.hrtime){let r=process.hrtime();e=r[0]*1e3+r[1]/1e6}else e=Date.now();return e}var N=class{constructor(r,t){this.sampleSize=1,this.time=0,this.count=0,this.samples=0,this.lastTiming=0,this.lastSampleTime=0,this.lastSampleCount=0,this._count=0,this._time=0,this._samples=0,this._startTime=0,this._timerPending=!1,this.name=r,this.type=t,this.reset()}reset(){return this.time=0,this.count=0,this.samples=0,this.lastTiming=0,this.lastSampleTime=0,this.lastSampleCount=0,this._count=0,this._time=0,this._samples=0,this._startTime=0,this._timerPending=!1,this}setSampleSize(r){return this.sampleSize=r,this}incrementCount(){return this.addCount(1),this}decrementCount(){return this.subtractCount(1),this}addCount(r){return this._count+=r,this._samples++,this._checkSampling(),this}subtractCount(r){return this._count-=r,this._samples++,this._checkSampling(),this}addTime(r){return this._time+=r,this.lastTiming=r,this._samples++,this._checkSampling(),this}timeStart(){return this._startTime=ee(),this._timerPending=!0,this}timeEnd(){return this._timerPending?(this.addTime(ee()-this._startTime),this._timerPending=!1,this._checkSampling(),this):this}getSampleAverageCount(){return this.sampleSize>0?this.lastSampleCount/this.sampleSize:0}getSampleAverageTime(){return this.sampleSize>0?this.lastSampleTime/this.sampleSize:0}getSampleHz(){return this.lastSampleTime>0?this.sampleSize/(this.lastSampleTime/1e3):0}getAverageCount(){return this.samples>0?this.count/this.samples:0}getAverageTime(){return this.samples>0?this.time/this.samples:0}getHz(){return this.time>0?this.samples/(this.time/1e3):0}_checkSampling(){this._samples===this.sampleSize&&(this.lastSampleTime=this._time,this.lastSampleCount=this._count,this.count+=this._count,this.time+=this._time,this.samples+=this._samples,this._time=0,this._count=0,this._samples=0)}};var $=class{constructor(r){this.stats={},this.id=r.id,this.stats={},this._initializeStats(r.stats),Object.seal(this)}get(r,t="count"){return this._getOrCreate({name:r,type:t})}get size(){return Object.keys(this.stats).length}reset(){for(let r of Object.values(this.stats))r.reset();return this}forEach(r){for(let t of Object.values(this.stats))r(t)}getTable(){let r={};return this.forEach(t=>{r[t.name]={time:t.time||0,count:t.count||0,average:t.getAverageTime()||0,hz:t.getHz()||0}}),r}_initializeStats(r=[]){r.forEach(t=>this._getOrCreate(t))}_getOrCreate(r){let{name:t,type:o}=r,n=this.stats[t];return n||(r instanceof N?n=r:n=new N(t,o),this.stats[t]=n),n}};var Ut="Queued Requests",$t="Active Requests",Dt="Cancelled Requests",jt="Queued Requests Ever",zt="Active Requests Ever",Vt={id:"request-scheduler",throttleRequests:!0,maxRequests:6,debounceTime:0},re=class{constructor(r={}){c(this,"props");c(this,"stats");c(this,"activeRequestCount",0);c(this,"requestQueue",[]);c(this,"requestMap",new Map);c(this,"updateTimer",null);this.props={...Vt,...r},this.stats=new $({id:this.props.id}),this.stats.get(Ut),this.stats.get($t),this.stats.get(Dt),this.stats.get(jt),this.stats.get(zt)}scheduleRequest(r,t=()=>0){if(!this.props.throttleRequests)return Promise.resolve({done:()=>{}});if(this.requestMap.has(r))return this.requestMap.get(r);let o={handle:r,priority:0,getPriority:t},n=new Promise(s=>(o.resolve=s,o));return this.requestQueue.push(o),this.requestMap.set(r,n),this._issueNewRequests(),n}_issueRequest(r){let{handle:t,resolve:o}=r,n=!1,s=()=>{n||(n=!0,this.requestMap.delete(t),this.activeRequestCount--,this._issueNewRequests())};return this.activeRequestCount++,o?o({done:s}):Promise.resolve({done:s})}_issueNewRequests(){this.updateTimer!==null&&clearTimeout(this.updateTimer),this.updateTimer=setTimeout(()=>this._issueNewRequestsAsync(),this.props.debounceTime)}_issueNewRequestsAsync(){this.updateTimer!==null&&clearTimeout(this.updateTimer),this.updateTimer=null;let r=Math.max(this.props.maxRequests-this.activeRequestCount,0);if(r!==0){this._updateAllRequests();for(let t=0;t<r;++t){let o=this.requestQueue.shift();o&&this._issueRequest(o)}}}_updateAllRequests(){let r=this.requestQueue;for(let t=0;t<r.length;++t){let o=r[t];this._updateRequest(o)||(r.splice(t,1),this.requestMap.delete(o.handle),t--)}r.sort((t,o)=>t.priority-o.priority)}_updateRequest(r){return r.priority=r.getPriority(r.handle),r.priority<0?(r.resolve(null),!1):!0}};var De="",Or={};function Pr(e){De=e}function vr(){return De}function M(e){for(let r in Or)if(e.startsWith(r)){let t=Or[r];e=e.replace(r,t)}return!e.startsWith("http://")&&!e.startsWith("https://")&&(e=`${De}${e}`),e}var Ht="4.3.0-beta.3",$r={dataType:null,batchType:null,name:"JSON",id:"json",module:"json",version:Ht,extensions:["json","geojson"],mimeTypes:["application/json"],category:"json",text:!0,parseTextSync:Ur,parse:async e=>Ur(new TextDecoder().decode(e)),options:{}};function Ur(e){return JSON.parse(e)}function Dr(e){return e&&typeof e=="object"&&e.isBuffer}function ye(e){if(Dr(e))return e;if(e instanceof ArrayBuffer)return e;if(ArrayBuffer.isView(e))return e.byteOffset===0&&e.byteLength===e.buffer.byteLength?e.buffer:e.buffer.slice(e.byteOffset,e.byteOffset+e.byteLength);if(typeof e=="string"){let r=e;return new TextEncoder().encode(r).buffer}if(e&&typeof e=="object"&&e._toArrayBuffer)return e._toArrayBuffer();throw new Error("toArrayBuffer")}var W={};Tt(W,{dirname:()=>qt,filename:()=>Gt,join:()=>Qt,resolve:()=>Jt});function jr(){if(typeof process<"u"&&typeof process.cwd<"u")return process.cwd();let e=window.location?.pathname;return e?.slice(0,e.lastIndexOf("/")+1)||""}function Gt(e){let r=e?e.lastIndexOf("/"):-1;return r>=0?e.substr(r+1):""}function qt(e){let r=e?e.lastIndexOf("/"):-1;return r>=0?e.substr(0,r):""}function Qt(...e){let r="/";return e=e.map((t,o)=>(o&&(t=t.replace(new RegExp(`^${r}`),"")),o!==e.length-1&&(t=t.replace(new RegExp(`${r}$`),"")),t)),e.join(r)}function Jt(...e){let r=[];for(let s=0;s<e.length;s++)r[s]=e[s];let t="",o=!1,n;for(let s=r.length-1;s>=-1&&!o;s--){let i;s>=0?i=r[s]:(n===void 0&&(n=jr()),i=n),i.length!==0&&(t=`${i}/${t}`,o=i.charCodeAt(0)===te)}return t=Kt(t,!o),o?`/${t}`:t.length>0?t:"."}var te=47,je=46;function Kt(e,r){let t="",o=-1,n=0,s,i=!1;for(let a=0;a<=e.length;++a){if(a<e.length)s=e.charCodeAt(a);else{if(s===te)break;s=te}if(s===te){if(!(o===a-1||n===1))if(o!==a-1&&n===2){if(t.length<2||!i||t.charCodeAt(t.length-1)!==je||t.charCodeAt(t.length-2)!==je){if(t.length>2){let f=t.length-1,u=f;for(;u>=0&&t.charCodeAt(u)!==te;--u);if(u!==f){t=u===-1?"":t.slice(0,u),o=a,n=0,i=!1;continue}}else if(t.length===2||t.length===1){t="",o=a,n=0,i=!1;continue}}r&&(t.length>0?t+="/..":t="..",i=!0)}else{let f=e.slice(o+1,a);t.length>0?t+=`/${f}`:t=f,i=!1}o=a,n=0}else s===je&&n!==-1?++n:n=-1}return t}var oe=class{constructor(r){c(this,"handle");c(this,"size");c(this,"bigsize");c(this,"url");this.handle=r instanceof ArrayBuffer?new Blob([r]):r,this.size=r instanceof ArrayBuffer?r.byteLength:r.size,this.bigsize=BigInt(this.size),this.url=r instanceof File?r.name:""}async close(){}async stat(){return{size:this.handle.size,bigsize:BigInt(this.handle.size),isDirectory:!1}}async read(r,t){return await this.handle.slice(r,r+t).arrayBuffer()}};var ne=new Error("Not implemented"),se=class{constructor(r,t,o){c(this,"handle");c(this,"size",0);c(this,"bigsize",0n);c(this,"url","");if(globalThis.loaders?.NodeFile)return new globalThis.loaders.NodeFile(r,t,o);throw p?new Error("Can't instantiate NodeFile in browser."):new Error("Can't instantiate NodeFile. Make sure to import @loaders.gl/polyfills first.")}async read(r,t){throw ne}async write(r,t,o){throw ne}async stat(){throw ne}async truncate(r){throw ne}async append(r){throw ne}async close(){}};var zr=e=>typeof e=="boolean",y=e=>typeof e=="function",S=e=>e!==null&&typeof e=="object",we=e=>S(e)&&e.constructor==={}.constructor,Yt=e=>S(e)&&y(e.then),be=e=>!!e&&typeof e[Symbol.iterator]=="function",xe=e=>e&&typeof e[Symbol.asyncIterator]=="function",Te=e=>e&&y(e.next),m=e=>typeof Response<"u"&&e instanceof Response||e&&e.arrayBuffer&&e.text&&e.json;var h=e=>typeof Blob<"u"&&e instanceof Blob,Vr=e=>e&&typeof e=="object"&&e.isBuffer,Zt=e=>S(e)&&y(e.abort)&&y(e.getWriter),Xt=e=>typeof ReadableStream<"u"&&e instanceof ReadableStream||S(e)&&y(e.tee)&&y(e.cancel)&&y(e.getReader),eo=e=>S(e)&&y(e.end)&&y(e.write)&&zr(e.writable),ro=e=>S(e)&&y(e.read)&&y(e.pipe)&&zr(e.readable),D=e=>Xt(e)||ro(e),to=e=>Zt(e)||eo(e);var ie=class extends Error{constructor(t,o){super(t);c(this,"reason");c(this,"url");c(this,"response");this.reason=o.reason,this.url=o.url,this.response=o.response}};var oo=/^data:([-\w.]+\/[-\w.+]+)(;|,)/,no=/^([-\w.]+\/[-\w.+]+)/;function ze(e,r){return e.toLowerCase()===r.toLowerCase()}function Hr(e){let r=no.exec(e);return r?r[1]:e}function Ve(e){let r=oo.exec(e);return r?r[1]:""}var Gr=/\?.*/;function qr(e){let r=e.match(Gr);return r&&r[0]}function j(e){return e.replace(Gr,"")}function Qr(e){if(e.length<50)return e;let r=e.slice(e.length-15);return`${e.substr(0,32)}...${r}`}function w(e){return m(e)?e.url:h(e)?e.name||"":typeof e=="string"?e:""}function ae(e){if(m(e)){let r=e,t=r.headers.get("content-type")||"",o=j(r.url);return Hr(t)||Ve(o)}return h(e)?e.type||"":typeof e=="string"?Ve(e):""}function Jr(e){return m(e)?e.headers["content-length"]||-1:h(e)?e.size:typeof e=="string"?e.length:e instanceof ArrayBuffer||ArrayBuffer.isView(e)?e.byteLength:-1}async function Ae(e){if(m(e))return e;let r={},t=Jr(e);t>=0&&(r["content-length"]=String(t));let o=w(e),n=ae(e);n&&(r["content-type"]=n);let s=await io(e);s&&(r["x-first-bytes"]=s),typeof e=="string"&&(e=new TextEncoder().encode(e));let i=new Response(e,{headers:r});return Object.defineProperty(i,"url",{value:o}),i}async function He(e){if(!e.ok)throw await so(e)}async function so(e){let r=Qr(e.url),t=`Failed to fetch resource (${e.status}) ${e.statusText}: ${r}`;t=t.length>100?`${t.slice(0,100)}...`:t;let o={reason:e.statusText,url:e.url,response:e};try{let n=e.headers.get("Content-Type");o.reason=!e.bodyUsed&&n?.includes("application/json")?await e.json():await e.text()}catch{}return new ie(t,o)}async function io(e){if(typeof e=="string")return`data:,${e.slice(0,5)}`;if(e instanceof Blob){let t=e.slice(0,5);return await new Promise(o=>{let n=new FileReader;n.onload=s=>o(s?.target?.result),n.readAsDataURL(t)})}if(e instanceof ArrayBuffer){let t=e.slice(0,5);return`data:base64,${ao(t)}`}return null}function ao(e){let r="",t=new Uint8Array(e);for(let o=0;o<t.byteLength;o++)r+=String.fromCharCode(t[o]);return btoa(r)}function co(e){return!fo(e)&&!uo(e)}function fo(e){return e.startsWith("http:")||e.startsWith("https:")}function uo(e){return e.startsWith("data:")}async function z(e,r){if(typeof e=="string"){let t=M(e);return co(t)&&globalThis.loaders?.fetchNode?globalThis.loaders?.fetchNode(t,r):await fetch(t,r)}return await Ae(e)}async function lo(e,r,t){e instanceof Blob||(e=new Blob([e]));let o=e.slice(r,r+t);return await mo(o)}async function mo(e){return await new Promise((r,t)=>{let o=new FileReader;o.onload=n=>r(n?.target?.result),o.onerror=n=>t(n),o.readAsArrayBuffer(e)})}var Ge=new T({id:"loaders.gl"}),Se=class{log(){return()=>{}}info(){return()=>{}}warn(){return()=>{}}error(){return()=>{}}},ke=class{constructor(){c(this,"console");this.console=console}log(...r){return this.console.log.bind(this.console,...r)}info(...r){return this.console.info.bind(this.console,...r)}warn(...r){return this.console.warn.bind(this.console,...r)}error(...r){return this.console.error.bind(this.console,...r)}};var qe={fetch:null,mimeType:void 0,nothrow:!1,log:new ke,useLocalLibraries:!1,CDN:"https://unpkg.com/@loaders.gl",worker:!0,maxConcurrency:3,maxMobileConcurrency:1,reuseWorkers:p,_nodeWorkers:!1,_workerType:"",limit:0,_limitMB:0,batchSize:"auto",batchDebounceMs:0,metadata:!1,transforms:[]},Kr={throws:"nothrow",dataType:"(no longer used)",uri:"baseUri",method:"fetch.method",headers:"fetch.headers",body:"fetch.body",mode:"fetch.mode",credentials:"fetch.credentials",cache:"fetch.cache",redirect:"fetch.redirect",referrer:"fetch.referrer",referrerPolicy:"fetch.referrerPolicy",integrity:"fetch.integrity",keepalive:"fetch.keepalive",signal:"fetch.signal"};function ce(){globalThis.loaders=globalThis.loaders||{};let{loaders:e}=globalThis;return e._state||(e._state={}),e._state}function R(){let e=ce();return e.globalOptions=e.globalOptions||{...qe},e.globalOptions}function Xr(e){let r=ce(),t=R();r.globalOptions=et(t,e),Ie(e.modules)}function V(e,r,t,o){return t=t||[],t=Array.isArray(t)?t:[t],po(e,t),et(r,e,o)}function po(e,r){Yr(e,null,qe,Kr,r);for(let t of r){let o=e&&e[t.id]||{},n=t.options&&t.options[t.id]||{},s=t.deprecatedOptions&&t.deprecatedOptions[t.id]||{};Yr(o,t.id,n,s,r)}}function Yr(e,r,t,o,n){let s=r||"Top level",i=r?`${r}.`:"";for(let a in e){let f=!r&&S(e[a]),u=a==="baseUri"&&!r,k=a==="workerUrl"&&r;if(!(a in t)&&!u&&!k){if(a in o)Ge.warn(`${s} loader option '${i}${a}' no longer supported, use '${o[a]}'`)();else if(!f){let E=ho(a,n);Ge.warn(`${s} loader option '${i}${a}' not recognized. ${E}`)()}}}}function ho(e,r){let t=e.toLowerCase(),o="";for(let n of r)for(let s in n.options){if(e===s)return`Did you mean '${n.id}.${s}'?`;let i=s.toLowerCase();(t.startsWith(i)||i.startsWith(t))&&(o=o||`Did you mean '${n.id}.${s}'?`)}return o}function et(e,r,t){let n={...e.options||{}};return go(n,t),n.log===null&&(n.log=new Se),Zr(n,R()),Zr(n,r),n}function Zr(e,r){for(let t in r)if(t in r){let o=r[t];we(o)&&we(e[t])?e[t]={...e[t],...r[t]}:e[t]=r[t]}}function go(e,r){r&&!("baseUri"in e)&&(e.baseUri=r)}function b(e){return e?(Array.isArray(e)&&(e=e[0]),Array.isArray(e?.extensions)):!1}function fe(e){q(e,"null loader"),q(b(e),"invalid loader");let r;return Array.isArray(e)&&(r=e[1],e=e[0],e={...e,options:{...e.options,...r}}),(e?.parseTextSync||e?.parseText)&&(e.text=!0),e.text||(e.binary=!0),e}var rt=()=>{let e=ce();return e.loaderRegistry=e.loaderRegistry||[],e.loaderRegistry};function yo(e){let r=rt();e=Array.isArray(e)?e:[e];for(let t of e){let o=fe(t);r.find(n=>o===n)||r.unshift(o)}}function tt(){return rt()}function wo(){let e=ce();e.loaderRegistry=[]}var bo=/\.([^.]+)$/;async function le(e,r=[],t,o){if(!nt(e))return null;let n=ue(e,r,{...t,nothrow:!0},o);if(n)return n;if(h(e)&&(e=await e.slice(0,10).arrayBuffer(),n=ue(e,r,t,o)),!n&&!t?.nothrow)throw new Error(st(e));return n}function ue(e,r=[],t,o){if(!nt(e))return null;if(r&&!Array.isArray(r))return fe(r);let n=[];r&&(n=n.concat(r)),t?.ignoreRegisteredLoaders||n.push(...tt()),To(n);let s=xo(e,n,t,o);if(!s&&!t?.nothrow)throw new Error(st(e));return s}function xo(e,r,t,o){let n=w(e),s=ae(e),i=j(n)||o?.url,a=null,f="";return t?.mimeType&&(a=Qe(r,t?.mimeType),f=`match forced by supplied MIME type ${t?.mimeType}`),a=a||Ao(r,i),f=f||(a?`matched url ${i}`:""),a=a||Qe(r,s),f=f||(a?`matched MIME type ${s}`:""),a=a||ko(r,e),f=f||(a?`matched initial data ${it(e)}`:""),t?.fallbackMimeType&&(a=a||Qe(r,t?.fallbackMimeType),f=f||(a?`matched fallback MIME type ${s}`:"")),f&&Le.log(1,`selectLoader selected ${a?.name}: ${f}.`),a}function nt(e){return!(e instanceof Response&&e.status===204)}function st(e){let r=w(e),t=ae(e),o="No valid loader found (";o+=r?`${W.filename(r)}, `:"no url provided, ",o+=`MIME type: ${t?`"${t}"`:"not provided"}, `;let n=e?it(e):"";return o+=n?` first bytes: "${n}"`:"first bytes: not available",o+=")",o}function To(e){for(let r of e)fe(r)}function Ao(e,r){let t=r&&bo.exec(r),o=t&&t[1];return o?So(e,o):null}function So(e,r){r=r.toLowerCase();for(let t of e)for(let o of t.extensions)if(o.toLowerCase()===r)return t;return null}function Qe(e,r){for(let t of e)if(t.mimeTypes?.some(o=>ze(r,o))||ze(r,`application/x.${t.id}`))return t;return null}function ko(e,r){if(!r)return null;for(let t of e)if(typeof r=="string"){if(_o(r,t))return t}else if(ArrayBuffer.isView(r)){if(ot(r.buffer,r.byteOffset,t))return t}else if(r instanceof ArrayBuffer&&ot(r,0,t))return t;return null}function _o(e,r){return r.testText?r.testText(e):(Array.isArray(r.tests)?r.tests:[r.tests]).some(o=>e.startsWith(o))}function ot(e,r,t){return(Array.isArray(t.tests)?t.tests:[t.tests]).some(n=>Eo(e,r,t,n))}function Eo(e,r,t,o){if(o instanceof ArrayBuffer)return $e(o,e,o.byteLength);switch(typeof o){case"function":return o(e);case"string":let n=Je(e,r,o.length);return o===n;default:return!1}}function it(e,r=5){return typeof e=="string"?e.slice(0,r):ArrayBuffer.isView(e)?Je(e.buffer,e.byteOffset,r):e instanceof ArrayBuffer?Je(e,0,r):""}function Je(e,r,t){if(e.byteLength<r+t)return"";let o=new DataView(e),n="";for(let s=0;s<t;s++)n+=String.fromCharCode(o.getUint8(r+s));return n}function*at(e,r){let t=r?.chunkSize||262144,o=0,n=new TextEncoder;for(;o<e.length;){let s=Math.min(e.length-o,t),i=e.slice(o,o+s);o+=s,yield n.encode(i)}}function*ct(e,r={}){let{chunkSize:t=262144}=r,o=0;for(;o<e.byteLength;){let n=Math.min(e.byteLength-o,t),s=new ArrayBuffer(n),i=new Uint8Array(e,o,n);new Uint8Array(s).set(i),o+=n,yield s}}async function*ft(e,r){let t=r?.chunkSize||1048576,o=0;for(;o<e.size;){let n=o+t,s=await e.slice(o,n).arrayBuffer();o=n,yield s}}function Ke(e,r){return p?Bo(e,r):Lo(e,r)}async function*Bo(e,r){let t=e.getReader(),o;try{for(;;){let n=o||t.read();r?._streamReadAhead&&(o=t.read());let{done:s,value:i}=await n;if(s)return;yield ye(i)}}catch{t.releaseLock()}}async function*Lo(e,r){for await(let t of e)yield ye(t)}function me(e,r){if(typeof e=="string")return at(e,r);if(e instanceof ArrayBuffer)return ct(e,r);if(h(e))return ft(e,r);if(D(e))return Ke(e,r);if(m(e))return Ke(e.body,r);throw new Error("makeIterator")}var Ye="Cannot convert supplied data type";function Ze(e,r,t){if(r.text&&typeof e=="string")return e;if(Vr(e)&&(e=e.buffer),e instanceof ArrayBuffer){let o=e;return r.text&&!r.binary?new TextDecoder("utf8").decode(o):o}if(ArrayBuffer.isView(e)){if(r.text&&!r.binary)return new TextDecoder("utf8").decode(e);let o=e.buffer,n=e.byteLength||e.length;return(e.byteOffset!==0||n!==o.byteLength)&&(o=o.slice(e.byteOffset,e.byteOffset+n)),o}throw new Error(Ye)}async function ut(e,r,t){let o=e instanceof ArrayBuffer||ArrayBuffer.isView(e);if(typeof e=="string"||o)return Ze(e,r,t);if(h(e)&&(e=await Ae(e)),m(e)){let n=e;return await He(n),r.binary?await n.arrayBuffer():await n.text()}if(D(e)&&(e=me(e,t)),be(e)||xe(e))return U(e);throw new Error(Ye)}async function lt(e,r){if(Te(e))return e;if(m(e)){let t=e;await He(t);let o=await t.body;return me(o,r)}return h(e)||D(e)?me(e,r):xe(e)?e:Ro(e)}function Ro(e){if(ArrayBuffer.isView(e))return function*(){yield e.buffer}();if(e instanceof ArrayBuffer)return function*(){yield e}();if(Te(e))return e;if(be(e))return e[Symbol.iterator]();throw new Error(Ye)}function H(e,r){let t=R(),o=e||t;return typeof o.fetch=="function"?o.fetch:S(o.fetch)?n=>z(n,o.fetch):r?.fetch?r?.fetch:z}function G(e,r,t){if(t)return t;let o={fetch:H(r,e),...e};if(o.url){let n=j(o.url);o.baseUrl=n,o.queryString=qr(o.url),o.filename=W.filename(n),o.baseUrl=W.dirname(n)}return Array.isArray(o.loaders)||(o.loaders=null),o}function _e(e,r){if(e&&!Array.isArray(e))return e;let t;if(e&&(t=Array.isArray(e)?e:[e]),r&&r.loaders){let o=Array.isArray(r.loaders)?r.loaders:[r.loaders];t=t?[...t,...o]:o}return t&&t.length?t:void 0}async function _(e,r,t,o){r&&!Array.isArray(r)&&!b(r)&&(o=void 0,t=r,r=void 0),e=await e,t=t||{};let n=w(e),i=_e(r,o),a=await le(e,i,t);return a?(t=V(t,a,i,n),o=G({url:n,_parse:_,loaders:i},t,o||null),await Io(a,e,t,o)):null}async function Io(e,r,t,o){if(Oe(e),t=Re(e.options,t),m(r)){let s=r,{ok:i,redirected:a,status:f,statusText:u,type:k,url:E}=s,nr=Object.fromEntries(s.headers.entries());o.response={headers:nr,ok:i,redirected:a,status:f,statusText:u,type:k,url:E}}r=await ut(r,e,t);let n=e;if(n.parseTextSync&&typeof r=="string")return n.parseTextSync(r,t,o);if(Pe(e,t))return await ve(e,r,t,o,_);if(n.parseText&&typeof r=="string")return await n.parseText(r,t,o);if(n.parse)return await n.parse(r,t,o);throw l(!n.parseSync),new Error(`${e.id} loader - no parser found and worker is disabled`)}function Fo(e,r,t,o){!Array.isArray(r)&&!b(r)&&(o=void 0,t=r,r=void 0),t=t||{};let s=_e(r,o),i=ue(e,s,t);if(!i)return null;t=V(t,i,s);let a=w(e),f=()=>{throw new Error("parseSync called parse (which is async")};return o=G({url:a,_parseSync:f,_parse:f,loaders:r},t,o||null),No(i,e,t,o)}function No(e,r,t,o){if(r=Ze(r,e,t),e.parseTextSync&&typeof r=="string")return e.parseTextSync(r,t);if(e.parseSync&&r instanceof ArrayBuffer)return e.parseSync(r,t,o);throw new Error(`${e.name} loader: 'parseSync' not supported by this loader, use 'parse' instead. ${o.url||""}`)}function Xe(e){switch(typeof e=="object"&&e?.shape){case"array-row-table":case"object-row-table":return Array.isArray(e.data);case"geojson-table":return Array.isArray(e.features);case"columnar-table":return e.data&&typeof e.data=="object";case"arrow-table":return e?.data?.numRows!==void 0;default:return!1}}function er(e){switch(e.shape){case"array-row-table":case"object-row-table":return e.data.length;case"geojson-table":return e.features.length;case"arrow-table":return e.data.numRows;case"columnar-table":for(let t of Object.values(e.data))return t.length||0;return 0;default:throw new Error("table")}}function rr(e){return{...e,length:er(e),batchType:"data"}}async function C(e,r,t,o){let n=Array.isArray(r)?r:void 0;!Array.isArray(r)&&!b(r)&&(o=void 0,t=r,r=void 0),e=await e,t=t||{};let s=w(e),i=await le(e,r,t);return i?(t=V(t,i,n,s),o=G({url:s,_parseInBatches:C,_parse:_,loaders:n},t,o||null),await Mo(i,e,t,o)):[]}async function Mo(e,r,t,o){let n=await Wo(e,r,t,o);if(!t.metadata)return n;let s={shape:"metadata",batchType:"metadata",metadata:{_loader:e,_context:o},data:[],bytesUsed:0};async function*i(a){yield s,yield*a}return i(n)}async function Wo(e,r,t,o){let n=await lt(r,t),s=await Po(n,t?.transforms||[]);return e.parseInBatches?e.parseInBatches(s,t,o):Co(s,e,t,o)}async function*Co(e,r,t,o){let n=await U(e),s=await _(n,r,{...t,mimeType:r.mimeTypes[0]},o);yield Oo(s,r)}function Oo(e,r){let t=Xe(e)?rr(e):{shape:"unknown",batchType:"data",data:e,length:Array.isArray(e)?e.length:1};return t.mimeType=r.mimeTypes[0],t}async function Po(e,r=[]){let t=e;for await(let o of r)t=o(t);return t}async function vo(e,r,t,o){let n,s;!Array.isArray(r)&&!b(r)?(n=[],s=r,o=void 0):(n=r,s=t);let i=H(s),a=e;return typeof e=="string"&&(a=await i(e)),h(e)&&(a=await i(e)),Array.isArray(n)?await _(a,n,s):await _(a,n,s)}function Uo(e,r,t,o){let n;!Array.isArray(r)&&!b(r)?(o=void 0,t=r,n=void 0):n=r;let s=H(t||{});return Array.isArray(e)?e.map(a=>mt(a,n,t||{},s)):mt(e,n,t||{},s)}async function mt(e,r,t,o){if(typeof e=="string"){let s=await o(e);return Array.isArray(r)?await C(s,r,t):await C(s,r,t)}return Array.isArray(r)?await C(e,r,t):await C(e,r,t)}async function pt(e,r,t){if(r.encode)return await r.encode(e,t);if(r.encodeText){let o=await r.encodeText(e,t);return new TextEncoder().encode(o)}if(r.encodeInBatches){let o=ht(e,r,t),n=[];for await(let s of o)n.push(s);return X(...n)}throw new Error("Writer could not encode data")}async function $o(e,r,t){if(r.text&&r.encodeText)return await r.encodeText(e,t);if(r.text){let o=await pt(e,r,t);return new TextDecoder().decode(o)}throw new Error(`Writer ${r.name} could not encode data as text`)}function ht(e,r,t){if(r.encodeInBatches){let o=Do(e);return r.encodeInBatches(o,t)}throw new Error("Writer could not encode data in batches")}function Do(e){return[{...e,start:0,end:e.length}]}async function jo(e,r,t){let n={...R(),...t};return r.encodeURLtoURL?Go(r,e,n):Ue(r,n)?await Ce(r,e,n):await r.encode(e,n)}function gt(e,r,t){if(r.encodeSync)return r.encodeSync(e,t);if(r.encodeTextSync)return new TextEncoder().encode(r.encodeTextSync(e,t));throw new Error(`Writer ${r.name} could not synchronously encode data`)}async function zo(e,r,t){if(r.encodeText)return await r.encodeText(e,t);if(r.encodeTextSync)return r.encodeTextSync(e,t);if(r.text){let o=await r.encode(e,t);return new TextDecoder().decode(o)}throw new Error(`Writer ${r.name} could not encode data as text`)}function Vo(e,r,t){if(r.encodeTextSync)return r.encodeTextSync(e,t);if(r.text&&r.encodeSync){let o=gt(e,r,t);return new TextDecoder().decode(o)}throw new Error(`Writer ${r.name} could not encode data as text`)}function Ho(e,r,t){if(r.encodeInBatches){let o=qo(e);return r.encodeInBatches(o,t)}throw new Error(`Writer ${r.name} could not encode in batches`)}async function yt(e,r,t,o){if(e=M(e),r=M(r),p||!t.encodeURLtoURL)throw new Error;return await t.encodeURLtoURL(e,r,o)}async function Go(e,r,t){if(p)throw new Error(`Writer ${e.name} not supported in browser`);let o=dt("input");await new se(o,"w").write(r);let s=dt("output"),i=await yt(o,s,e,t);return(await z(i)).arrayBuffer()}function qo(e){return[{...e,start:0,end:e.length}]}function dt(e){return`/tmp/${e}`}function Qo(e,r,t){let{type:o="auto"}=t,n=o==="auto"?Jo(e,r):Ko(o,r);if(!n)throw new Error("Not a valid image source type");return n.createDataSource(e,t)}function Jo(e,r){for(let t of r)if(t.testURL&&t.testURL(e))return t;return null}function Ko(e,r){for(let t of r)if(t.type===e)return t;return null}function Yo(e,r,t){let o=t?.type||"auto",n=null;if(o==="auto"){for(let s of r)if(typeof e=="string"&&s.testURL&&s.testURL(e))return s}else n=Zo(o,r);if(!n&&!t?.nothrow)throw new Error("Not a valid image source type");return n}function Zo(e,r){for(let t of r)if(t.type===e)return t;return null}function Xo(e,r){if(globalThis.loaders.makeNodeStream)return globalThis.loaders.makeNodeStream(e,r);let t=e[Symbol.asyncIterator]?e[Symbol.asyncIterator]():e[Symbol.iterator]();return new ReadableStream({type:"bytes",async pull(o){try{let{done:n,value:s}=await t.next();n?o.close():o.enqueue(new Uint8Array(s))}catch(n){o.error(n)}},async cancel(){await t?.return?.()}},{highWaterMark:2**24,...r})}var wt="4.3.0-beta.3",en={dataType:null,batchType:null,name:"Null loader",id:"null",module:"core",version:wt,worker:!0,mimeTypes:["application/x.empty"],extensions:["null"],tests:[()=>!1],options:{null:{}}},rn={dataType:null,batchType:null,name:"Null loader",id:"null",module:"core",version:wt,mimeTypes:["application/x.empty"],extensions:["null"],parse:async(e,r,t)=>tr(e,r||{},t),parseSync:tr,parseInBatches:async function*(r,t,o){for await(let n of r)yield tr(n,t,o)},tests:[()=>!1],options:{null:{}}};function tr(e,r,t){return null}async function tn(e,r,t=()=>{},o=()=>{}){if(e=await e,!e.ok)return e;let n=e.body;if(!n)return e;let s=e.headers.get("content-length")||0,i=s?parseInt(s):0;if(!(i>0)||typeof ReadableStream>"u"||!n.getReader)return e;let a=new ReadableStream({async start(f){let u=n.getReader();await bt(f,u,0,i,r,t,o)}});return new Response(a)}async function bt(e,r,t,o,n,s,i){try{let{done:a,value:f}=await r.read();if(a){s(),e.close();return}t+=f.byteLength;let u=Math.round(t/o*100);n(u,{loadedBytes:t,totalBytes:o}),e.enqueue(f),await bt(e,r,t,o,n,s,i)}catch(a){e.error(a),i(a)}}var or=class{constructor(r,t){c(this,"_fetch");c(this,"files",{});c(this,"lowerCaseFiles",{});c(this,"usedFiles",{});this._fetch=t?.fetch||fetch;for(let o=0;o<r.length;++o){let n=r[o];this.files[n.name]=n,this.lowerCaseFiles[n.name.toLowerCase()]=n,this.usedFiles[n.name]=!1}this.fetch=this.fetch.bind(this)}async fetch(r,t){if(r.includes("://"))return this._fetch(r,t);let o=this.files[r];if(!o)return new Response(r,{status:400,statusText:"NOT FOUND"});let s=new Headers(t?.headers).get("Range"),i=s&&/bytes=($1)-($2)/.exec(s);if(i){let f=parseInt(i[1]),u=parseInt(i[2]),k=await o.slice(f,u).arrayBuffer(),E=new Response(k);return Object.defineProperty(E,"url",{value:r}),E}let a=new Response(o);return Object.defineProperty(a,"url",{value:r}),a}async readdir(r){let t=[];for(let o in this.files)t.push(o);return t}async stat(r,t){let o=this.files[r];if(!o)throw new Error(r);return{size:o.size}}async unlink(r){delete this.files[r],delete this.lowerCaseFiles[r],this.usedFiles[r]=!0}async openReadableFile(r,t){return new oe(this.files[r])}_getFile(r,t){let o=this.files[r]||this.lowerCaseFiles[r];return o&&t&&(this.usedFiles[r]=!0),o}};export{ie as FetchError,$r as JSONLoader,rn as NullLoader,en as NullWorkerLoader,re as RequestScheduler,or as _BrowserFileSystem,tn as _fetchProgress,Yo as _selectSource,wo as _unregisterLoaders,q as assert,U as concatenateArrayBuffersAsync,Qo as createDataSource,ur as document,jo as encode,Ho as encodeInBatches,gt as encodeSync,pt as encodeTable,$o as encodeTableAsText,ht as encodeTableInBatches,zo as encodeText,Vo as encodeTextSync,yt as encodeURLtoURL,z as fetchFile,Cr as forEach,R as getLoaderOptions,vr as getPathPrefix,fr as global,xe as isAsyncIterable,p as isBrowser,be as isIterable,Te as isIterator,Yt as isPromise,we as isPureObject,D as isReadableStream,m as isResponse,lr as isWorker,to as isWritableStream,vo as load,Uo as loadInBatches,me as makeIterator,Mr as makeLineIterator,Wr as makeNumberedLineIterator,Xo as makeStream,Fr as makeTextDecoderIterator,Nr as makeTextEncoderIterator,_ as parse,C as parseInBatches,Fo as parseSync,lo as readArrayBuffer,yo as registerLoaders,M as resolvePath,le as selectLoader,ue as selectLoaderSync,ar as self,Xr as setLoaderOptions,Pr as setPathPrefix,cr as window};
